---
layout: post
title: "Flush"
date: 2022-02-20 16:21:00 +0900
categories: jekyll update
---
# Flush

Persistence Context ì˜ ë³€ê²½ ë‚´ìš©ì„ ë°ì´í„°ë² ì´ìŠ¤ì— ë°˜ì˜í•˜ëŠ” ê²ƒ

---

### Flush ë°œìƒ ì‹œ

1. ë³€ê²½ ê°ì§€ (Dirty Checking)
2. ë³€ê²½ëœ Entity ì“°ê¸° ì§€ì—° SQL ì €ì¥ì†Œì— ì €ì¥
3. ì €ì¥ëœ Query ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ì „ì†¡ (INSERT, UPDATE, DELETE Query)

### Flush ë°©ë²•

- ì§ì ‘ í˜¸ì¶œ

```java
em.flush();
```

<aside>
ğŸ’¡ Flush ëŠ” ì˜¤ì§ ì“°ê¸° ì§€ì—° SQL ì €ì¥ì†Œì— ì €ì¥ëœ Query ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ì „ì†¡í•´ì£¼ëŠ” ê²ƒ

</aside>

- ìë™ í˜¸ì¶œ
    - Transaction Commit
    - JPQL Query ì‹¤í–‰
    
    JPQL Query ì‹¤í–‰ ì‹œ, Flush ê°€ ìë™ í˜¸ì¶œë˜ëŠ” ì´ìœ ?
    
    ```java
    em.persist(memberA);
    em.persist(memberB);
    em.persist(memberC);
    // ì—¬ê¸°ê¹Œì§€ ì“°ê¸° ì§€ì—° SQL ì €ì¥ì†Œì— Query ê°€ ì €ì¥ë  ë¿, ì‹¤ì œë¡œ DB ì—ëŠ” ë°˜ì˜ë˜ì§€ ì•ŠìŒ
    
    // ìœ„ ë‚´ìš©ì´ DB ì— ë°˜ì˜ë˜ì§€ ì•Šì€ ìƒíƒœì—ì„œ DB Table ì¡°íšŒ ì‹œ, ë°ì´í„°ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŒ
    // ì´ëŸ¬í•œ ë¬¸ì œë¥¼ ë°©ì§€í•˜ê³ ì JPQL Query ê°€ ì‹¤í–‰ë˜ê¸° ì „ì— ë¬´ì¡°ê±´ flush ë¥¼ ìë™ í˜¸ì¶œ
    query = em.createQuery("select m from Member m", Member.class);
    List<Member>members = query.getResultList();
    ```
    

### Flush ì •ë¦¬

- Persistence Context ë¥¼ ë¹„ìš°ì§€ëŠ” ì•ŠìŒ
- Persistence Context ì˜ **ë³€ê²½ ë‚´ìš©ì„ ë°ì´í„°ë² ì´ìŠ¤ì— ë™ê¸°í™”**
- Transaction Commit ì§ì „ì— ë³€ê²½ ë‚´ìš©ì„ DB ì— ì „ì†¡í•´ì£¼ë©´ ë¨